---
title: "metabolite plots"
author: "Sam Herr"
date: "2023-01-05"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
library(openxlsx)
```
This rmarkdown is to create visualizations of metabolite phenotypes from the light and dark experiment.

Each code chunk creates both pdfs and .tiff files for each dataset.
The first code chunk will be commented but the other two will not be as they are duplicates.

File input requires light_dark_analysis to be run to obtain BLUE values for each tissue and year combination

```{r functions}
#used for paper 
calculate_percent_increase <- function(original_value, new_value) {
  # Calculate the difference
  difference <- new_value - original_value
  
  # Calculate percent increase
  percent_increase <- (difference / original_value) * 100
  
  # Return the percent increase
  return(percent_increase)
}
#for naming purposes on plot
replace_with_greek <- function(input_string) {
  # Replace 'a' with 'α' (alpha)
  input_string <- gsub("^a", "α", input_string)
  
  # Replace 'd' with 'δ' (delta)
  input_string <- gsub("^d", "δ", input_string)
  
  # Replace 'g' with 'γ' (gamma)
  input_string <- gsub("^g", "γ", input_string)
  input_string <- gsub("^B", "β", input_string)

  
  input_string <- gsub("-T3", " Tocotrienol", input_string)
  
  # Replace "T" with "Tocopherol"
  input_string <- gsub("-T", " Tocopherol", input_string)

  return(input_string)
}

```

```{r 2018 embryo}

#read in dataset 
#gotten from light_dark_analysis.Rmd
blue = read.csv('../data/embryo_2018_blues.csv', row.names = 1)

#formatting issues
blue$BLUE=as.numeric(blue$BLUE)
blue$SE=as.numeric(blue$SE)
blue$genotype <- toupper(blue$genotype)
blue[blue$trait == "neo",]$trait <- "Neoxanthin"
blue[blue$trait == "vio",]$trait <- "Violaxanthin"

blue$trait <- replace_with_greek(blue$trait)
colnames(blue)[2] <- "Treatment"
blue$Treatment <- paste0(toupper(substr(blue$Treatment, 1, 1)), substr(blue$Treatment, 2, nchar(blue$Treatment)))

#get percentage change values between treatments
mean_values <- blue %>%
  group_by(genotype, trait) %>%
  summarise(cl = calculate_percent_increase(BLUE[Treatment == "Control"], BLUE[Treatment == "Light"]),ld = calculate_percent_increase(BLUE[Treatment == "Light"], BLUE[Treatment == "Dark"]),
            cd = calculate_percent_increase(BLUE[Treatment == "Control"], BLUE[Treatment == "Dark"])
            ) %>%
  ungroup()

#create dataframes
traits=unique(blue$trait)
genotype=c("B73","B97","KI11","M37W","MS71","NC358","OH7B")#same order as shown on barplot
tukey=data.frame(matrix(nrow=357,ncol=4))
names(tukey)=c("Trait","Genotype","Treatment","letter.assignment")
tukey$Trait=rep(traits,21)
tukey=tukey[order(tukey$Trait),]
tukey$Genotype=rep(genotype,51)
tukey=tukey[order(tukey$Trait,tukey$Genotype),]
tukey$Treatment=c('Dark','Control','Light')

# assign letters from Tukey -----------------------------------------------
#gotten after running light_dark_analysis.Rmd
tukey_res=as.data.frame(readxl::read_xlsx('../data/Supplemental Dataset S2.xlsx',sheet = 3))
row.names(tukey_res) <- tukey_res[,1]

tukey_res <- t(tukey_res[,-1]) 
colnames(tukey_res)[1:2] <- c("Neoxanthin","Violaxanthin")

tukey_res <- cbind(separate(as.data.frame(row.names(tukey_res)), 1, c("Geno", "Treatment1","Treatment2" )), tukey_res)

tukey_res$Treatment1 <- paste0(toupper(substr(tukey_res$Treatment1, 1, 1)), substr(tukey_res$Treatment1, 2, nchar(tukey_res$Treatment1)))

tukey_res$Treatment2 <- paste0(toupper(substr(tukey_res$Treatment2, 1, 1)), substr(tukey_res$Treatment2, 2, nchar(tukey_res$Treatment2)))


tukey_res<- tukey_res %>% pivot_longer(! c("Geno", "Treatment1", "Treatment2"), names_to = "Trait", values_to =  "P")
tukey_res$Geno <- toupper(tukey_res$Geno)
tukey_res$Trait <- replace_with_greek(tukey_res$Trait)
p_list <- list()

for (t in traits){
  for (i in genotype){
    curr=tukey_res[which(tukey_res$Trait==t & tukey_res$Geno==i),]
    
    dc=curr$P[which(curr$Treatment2=='Control'&curr$Treatment1=='Dark')]
    dl=curr$P[which(curr$Treatment2=='Dark'&curr$Treatment1=='Light')]
    lc=curr$P[which(curr$Treatment2=='Control'&curr$Treatment1=='Light')]
    
    tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Dark')]='a' #fix dark to a
    
    if (dc<0.01){
      tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Control')]='b' 
      if (lc < 0.01 & dl < 0.01){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='c' 
      }else if(lc < 0.01 & dl >= 0.01){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='a' 
      }else if(lc >= 0.01 & dl < 0.01){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='b'
      }else{
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='ab' 
      }
    }
    if (dc>=0.01){
      tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Control')]='a' 
      if (lc < 0.01 & dl < 0.01){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='b' 
      }else if(lc < 0.01 & dl >= 0.01){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='b'
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Dark')]='ab'
      }else if(lc >= 0.01 & dl < 0.01){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='b'
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Control')]='ab'
      }else{
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='Light')]='a' 
      }
    }
  }
}


tukey$ID=paste(tukey$Genotype,tukey$Treatment,sep='_')


#for loop creates a plot for each trait
iter = 1
for ( t in traits){
  #subset data frame
  curr=blue[which(blue$trait==t),]
  curr$ID=paste(curr$genotype,curr$Treatment,sep='_')
  tukey_curr=tukey[which(tukey$Trait==t),]
  
  #get name correct
  t = paste0(t, " (ng/mg fresh tissue)")
   
  
  all=merge(curr,tukey_curr[,c('ID','letter.assignment')],by='ID')
  all$treatment=str_to_title(all$Treatment)
  all$treatment=factor(all$Treatment,levels=c('Dark','Control','Light'))
  
  p=ggplot(all, aes(x=treatment, y=BLUE, fill=Treatment)) + 
    geom_bar(stat="identity", color="black", position=position_dodge()) +  
    facet_grid(~genotype)+
    labs(y=paste(t), x = NULL)+
    
    geom_errorbar(aes(ymin=(BLUE-SE), ymax=(BLUE+SE)), width=.2,position=position_dodge(.9))+
    geom_text(aes(label = letter.assignment, y =BLUE +SE), vjust = -0.5,size=10) +
    theme_bw()+  
    
    theme(plot.background = element_blank(),     
          panel.spacing.x=unit(0.5,"lines"),
          
          strip.text.x = element_text(size = 18,face="bold",color="black", angle =360,family='Helvetica'),
          axis.title.y = element_text(family='Helvetica', size = 18),

          axis.text.x = element_blank(),
          axis.text.y = element_text(family='Helvetica', size = 18),
          axis.ticks.x = element_blank(),
         )
  
  # assign significance level from Tukey ------------------------------------

  p2=p+scale_fill_manual(values=c('dodgerblue','black',"#E69F00"))
  #make the scale more readable
  p2 = p2+
    theme(axis.title = element_text(size =25)) 
  if(min(curr$BLUE) > 30){
      p2 <- p2+ ylim(c(-5 ,max(curr$BLUE) + 0.4 *max(curr$BLUE)))

  }else{
      p2 <- p2+ ylim(c(-0.05 ,max(curr$BLUE) + 0.4 *max(curr$BLUE) +0.2))

  }

  p_list[[iter]] = p2
  iter = iter + 1
}

 
#use ggarrange to combine indiviual trait plots together for manuscript
ggarrange(p_list[[7]],p_list[[14]],p_list[[15]],p_list[[17]],  nrow = 2, ncol = 2, common.legend = T, legend = "right")

ggsave("Figure_2.png", width = 24, height = 12, units = "in", bg ="white")

ggarrange(p_list[[8]],p_list[[9]],p_list[[10]],p_list[[14]],p_list[[11]],p_list[[12]],p_list[[13]],p_list[[15]],  nrow = 2, ncol = 4, common.legend = T, legend = "right")
ggsave("2018_embryo_S2.png", width = 30, height = 12, units = "in", bg ="white")


ggarrange(p_list[[1]],p_list[[2]],p_list[[3]],p_list[[4]],p_list[[5]],p_list[[6]],  nrow = 2, ncol = 3, common.legend = T, legend = "right")
ggsave("Figure_S6.png", width = 26, height = 12, units = "in", bg ="white")




```

```{r 2018 mature}

replace_with_greek <- function(input_string) {
  # Replace 'a' with 'α' (alpha)
  input_string <- gsub("^a", "α", input_string)
  
  # Replace 'd' with 'δ' (delta)
  input_string <- gsub("^d", "δ", input_string)
  
  # Replace 'g' with 'γ' (gamma)
  input_string <- gsub("^g", "γ", input_string)
  
  # Return the modified string
  input_string <- gsub(".T3$", " Tocotrienol", input_string)
  
  # Replace "T" with "Tocopherol"
  input_string <- gsub(".T$", " Tocopherol", input_string)
  return(input_string)
}

library(plyr)

blue=read.csv('../data/mature_2018_blues.csv', row.names = 1)
blue$treatment <- tolower(blue$treatment)


blue$BLUE=as.numeric(blue$BLUE)
blue$SE=as.numeric(blue$SE)
blue$genotype <- toupper(blue$genotype)
blue$trait <- replace_with_greek(blue$trait)


mean_values <- blue %>%
  group_by(genotype, trait) %>%
  summarise(cl = calculate_percent_increase(BLUE[treatment == "control"], BLUE[treatment == "light"]),ld = calculate_percent_increase(BLUE[treatment == "light"], BLUE[treatment == "dark"]),
            cd = calculate_percent_increase(BLUE[treatment == "control"], BLUE[treatment == "dark"])
            ) %>%
  ungroup()


traits=unique(blue$trait)
genotype=c("B73","B97","KI11","M37W","MS71","NC358","OH7B")#same order as shown on barplot

tukey=data.frame(matrix(nrow=189,ncol=4))
names(tukey)=c("Trait","Genotype","Treatment","letter.assignment")
tukey$Trait=rep(traits,21)
tukey=tukey[order(tukey$Trait),]
tukey$Genotype=rep(genotype,27)
tukey=tukey[order(tukey$Trait,tukey$Genotype),]
tukey$Treatment=c('dark','control','light')

# assign letters from Tukey -----------------------------------------------
tukey_res=read.xlsx('../data/metabolites_mature_2018.xlsx',3)
row.names(tukey_res) <- tukey_res[,1]

tukey_res <- t(tukey_res[,-1]) 
tukey_res <- cbind(separate(as.data.frame(row.names(tukey_res)), 1, c("Geno", "Treatment1", "Treatment2"),"_"), tukey_res)

tukey_res<- tukey_res %>% pivot_longer(! c("Geno", "Treatment1", "Treatment2"), names_to = "Trait", values_to =  "P")
tukey_res$Geno <- toupper(tukey_res$Geno)
tukey_res$Trait <- replace_with_greek(tukey_res$Trait)

p_list <- list()

for (t in traits){
  for (i in genotype){
    curr=tukey_res[which(tukey_res$Trait==t & tukey_res$Geno==i),]
    
    dc=curr$P[which(curr$Treatment2=='control'&curr$Treatment1=='dark')]
    dl=curr$P[which(curr$Treatment2=='dark'&curr$Treatment1=='light')]
    lc=curr$P[which(curr$Treatment2=='control'&curr$Treatment1=='light')]
    
    tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='dark')]='a' #fix dark to a
    
    if (dc<0.05){
      tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='control')]='b' 
      if (lc < 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='c' 
      }else if(lc < 0.05 & dl >= 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='a' 
      }else if(lc >= 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b'
      }else{
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='ab' 
      }
    }
    if (dc>=0.05){
      tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='control')]='a' 
      if (lc < 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b' 
      }else if(lc < 0.05 & dl >= 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b'
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='dark')]='ab'
      }else if(lc >= 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b'
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='control')]='ab'
      }else{
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='a' 
      }
    }
  }
}


tukey$ID=paste(tukey$Genotype,tukey$Treatment,sep='_')

iter = 1
for ( t in traits){
  curr=blue[which(blue$trait==t),]
  curr$ID=paste(curr$genotype,curr$treatment,sep='_')
  tukey_curr=tukey[which(tukey$Trait==t),]
    
  if(t== "Total Carotenoids"){
    t = "Total Carotenoids (ng/mg dry seed)"
    print(t)
  }else if(grepl("Tocopherol|Tocotrienol|Chlorophyll", t, ignore.case = TRUE)){
    t = paste0(t, " (ng/mg dry seed)")
    print(t)
  }
  
  all=merge(curr,tukey_curr[,c('ID','letter.assignment')],by='ID')
  all$treatment=str_to_title(all$treatment)
  all$treatment=factor(all$treatment,levels=c('Dark','Control','Light'))
  
  p=ggplot(all, aes(x=treatment, y=BLUE, fill=treatment)) + 
    geom_bar(stat="identity", color="black", position=position_dodge()) +  
    facet_grid(~genotype)+
    labs(y=paste(t), x = NULL)+
    
    geom_errorbar(aes(ymin=(BLUE-SE), ymax=(BLUE+SE)), width=.2,position=position_dodge(.9))+
    geom_text(aes(label = letter.assignment, y =BLUE +SE), vjust = -0.5,size=10) +
    theme_bw()+  
    
 theme(plot.background = element_blank(),     
          panel.spacing.x=unit(0.5,"lines"),
          
          strip.text.x = element_text(size = 18,face="bold",color="black", angle =360,family='Helvetica'),
          axis.title.y = element_text(family='Helvetica', size = 18),

          axis.text.x = element_blank(),
          axis.text.y = element_text(family='Helvetica', size = 18),
          axis.ticks.x = element_blank(),
         )
  
  
  # assign significance level from Tukey ------------------------------------

  p2=p+scale_fill_manual(values=c('black','dodgerblue',"#E69F00"))
  
  p2 = p2+
    theme(axis.title = element_text(size =25)) 
  if(min(curr$BLUE) > 30){
      p2 <- p2+ ylim(c(-5 ,max(curr$BLUE) + 0.4 *max(curr$BLUE)))

  }else{
      p2 <- p2+ ylim(c(-0.05 ,max(curr$BLUE) + 0.4 *max(curr$BLUE) +0.2))

  }

  p_list[[iter]] = p2
  iter = iter + 1
}

ggarrange(p_list[[1]],p_list[[2]],p_list[[3]],p_list[[7]],p_list[[4]],p_list[[5]],p_list[[6]],p_list[[8]], nrow = 2, ncol = 4, common.legend = T, legend = "bottom")
#ggsave("2018_mature_metabolites_S7.png", width = 26, height = 12, units = "in", bg ="white")


#pdf("2018_mature/2018_mature.tiff")
#for (i in 1:length(traits)) {
# print(i)
#  print(p_list[[i]])
#}
#dev.off()


```

```{r 2019 mature}
blue=read.csv('../data/mature_2019_blues.csv', row.names = 1)


blue$BLUE=as.numeric(blue$BLUE)
blue$SE=as.numeric(blue$SE)
blue$genotype <- toupper(blue$genotype)
blue$trait <- replace_with_greek(blue$trait)


mean_values <- blue %>%
  group_by(genotype, trait) %>%
  summarise(cl = calculate_percent_increase(BLUE[treatment == "control"], BLUE[treatment == "light"]),ld = calculate_percent_increase(BLUE[treatment == "light"], BLUE[treatment == "dark"]),
            cd = calculate_percent_increase(BLUE[treatment == "control"], BLUE[treatment == "dark"])
            ) %>%
  ungroup()


traits=unique(blue$trait)
genotype=c("B73","B97","OH7B")#same order as shown on barplot

tukey=data.frame(matrix(nrow=81,ncol=4))
names(tukey)=c("Trait","Genotype","Treatment","letter.assignment")
tukey$Trait=rep(traits,9)
tukey=tukey[order(tukey$Trait),]
tukey$Genotype=rep(genotype,27)
tukey=tukey[order(tukey$Trait,tukey$Genotype),]
tukey$Treatment=c('dark','control','light')

# assign letters from Tukey -----------------------------------------------
#dataset gotten after running light_dark_analysis.Rmd

tukey_res=read.xlsx('../data/metabolites_mature_2019.xlsx',3)
row.names(tukey_res) <- tukey_res[,1]

tukey_res <- t(tukey_res[,-1]) 
tukey_res <- cbind(separate(as.data.frame(row.names(tukey_res)), 1, c("Geno", "Treatment1", "Treatment2"),"_"), tukey_res)

tukey_res<- tukey_res %>% pivot_longer(! c("Geno", "Treatment1", "Treatment2"), names_to = "Trait", values_to =  "P")
tukey_res$Geno <- toupper(tukey_res$Geno)
tukey_res$Trait <- replace_with_greek(tukey_res$Trait)

p_list <- list()

for (t in traits){
  for (i in genotype){
    curr=tukey_res[which(tukey_res$Trait==t & tukey_res$Geno==i),]
    
    dc=curr$P[which(curr$Treatment2=='control'&curr$Treatment1=='dark')]
    dl=curr$P[which(curr$Treatment2=='dark'&curr$Treatment1=='light')]
    lc=curr$P[which(curr$Treatment2=='control'&curr$Treatment1=='light')]
    
    tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='dark')]='a' #fix dark to a
    
    if (dc<0.05){
      tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='control')]='b' 
      if (lc < 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='c' 
      }else if(lc < 0.05 & dl >= 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='a' 
      }else if(lc >= 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b'
      }else{
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='ab' 
      }
    }
    if (dc>=0.05){
      tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='control')]='a' 
      if (lc < 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b' 
      }else if(lc < 0.05 & dl >= 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b'
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='dark')]='ab'
      }else if(lc >= 0.05 & dl < 0.05){
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='b'
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='control')]='ab'
      }else{
        tukey$letter.assignment[which(tukey$Trait==t &tukey$Genotype==i & tukey$Treatment=='light')]='a' 
      }
    }
  }
}


tukey$ID=paste(tukey$Genotype,tukey$Treatment,sep='_')

iter = 1
for ( t in traits){
  curr=blue[which(blue$trait==t),]
  curr$ID=paste(curr$genotype,curr$treatment,sep='_')
  tukey_curr=tukey[which(tukey$Trait==t),]
  
  if(t== "Total Carotenoids"){
    t = "Total Carotenoids (Total area/mg fresh tissue)"
    print(t)
  }else if(grepl("Tocopherol|Tocotrienol|Chlorophyll", t, ignore.case = TRUE)){
    t = paste0(t, " (ng/mg dry seed)")
    print(t)
  }
  
  all=merge(curr,tukey_curr[,c('ID','letter.assignment')],by='ID')
  all$treatment=str_to_title(all$treatment)
  all$treatment=factor(all$treatment,levels=c('Dark','Control','Light'))
  
  p=ggplot(all, aes(x=treatment, y=BLUE, fill=treatment)) + 
    geom_bar(stat="identity", color="black", position=position_dodge()) +  
    facet_grid(~genotype)+
    labs(y=paste(t), x = NULL)+
    
    geom_errorbar(aes(ymin=(BLUE-SE), ymax=(BLUE+SE)), width=.2,position=position_dodge(.9))+
    geom_text(aes(label = letter.assignment, y =BLUE +SE), vjust = -0.5,size=10) +
    theme_bw()+  
    
    theme(plot.background = element_blank(),     
          panel.spacing.x=unit(0.5,"lines"),
          
          strip.text.x = element_text(size = 18,face="bold",color="black", angle =360,family='Helvetica'),
          axis.title.y = element_text(family='Helvetica', size = 18),

          axis.text.x = element_blank(),
          axis.text.y = element_text(family='Helvetica', size = 18),
          axis.ticks.x = element_blank(),
         )
  
  # assign significance level from Tukey ------------------------------------

  p2=p+scale_fill_manual(values=c('black','dodgerblue',"#E69F00"))
  
  p2 = p2+
    theme(axis.title = element_text(size =25)) 
  if(min(curr$BLUE) > 30){
      p2 <- p2+ ylim(c(-5 ,max(curr$BLUE) + 0.4 *max(curr$BLUE)))

  }else{
      p2 <- p2+ ylim(c(-0.05 ,max(curr$BLUE) + 0.4 *max(curr$BLUE) +0.2))

  }

  p_list[[iter]] = p2
  iter = iter + 1
}


ggarrange(p_list[[1]],p_list[[2]],p_list[[3]],p_list[[7]],p_list[[4]],p_list[[5]],p_list[[6]],p_list[[8]], nrow = 2, ncol = 4, common.legend = T, legend = "bottom")

#ggsave("2019_mature_metabolites.png", width = 28, height = 12, units = "in", bg ="white")





```
